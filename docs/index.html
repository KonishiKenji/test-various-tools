<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <title>various test web tool</title>
    
    <!-- CSS -->
    <style>
      .label-div{
        padding-left: 10px;
        padding-right: 10px;
      }
      .kakomi-title01 {
        margin:0em ;
        display:inline-block;
        position:relative;
        top:3px;
        padding:0 .5em;
        height:1.5em;
        line-height:1.5em;
        color:#ffffff;
        background:#ffc0c0;
        font-weight:bold;
        text-align:center;
        border-radius:5px 5px 0 0;
        margin-top: 10px;
      }
      .kakomi-frame01 {
        display: flex;
        flex-flow: row nowrap;
        background:rgba(255,255,255,0);
        border:solid 3px #ffc0c0;
        border-radius:0 5px 5px;
        padding:20px;
        font-size: 100%;
        margin-bottom: 10px;
      }
      .button-div{
        padding-left: 10px;
        padding-right: 10px;
      }
      .virticallist-div {
        display: flex;
        flex-flow: column nowrap;
      }
      .horizontallist-div {
        display: flex;
        flex-flow: row nowrap;
        padding-top: 10px;
      }
    </style>

    <script type="text/javascript" language="JavaScript">
      // load時に実行
      window.onload = function() {
        document.getElementById("slack").checked = true;
        document.getElementById("min_member").selectedIndex = 1;
        document.getElementById("message").innerHTML = "「WIP作成」または「random順番作成」ボタンを押してください";
      }
    </script>
  </head>


  <body>
        <div class='kakomi-title01'>
          WIP設定
        </div>
        <div class='kakomi-frame01'>
          <div class='label-div'>最大WIP数</div>
          <select id="max_wip" size="1">
            <option value="4">4</option>
            <option value="3" selected>3</option>
            <option value="2">2</option>
          </select>
          <div class='label-div'>最低人数/WIP</div>
          <select id="min_member" size="1">
            <option value="1">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
          </select>
          <div class='button-div'>
            <input type="button" value="WIP作成" onclick="clickBtn_createWip()"/>
          </div>
          <div class='button-div'>
            <input type="button" value="random順番作成" onclick="clickBtn_createRandom()"/>
          </div>
          <div class='button-div'>
            <input type="button" value="random選出" onclick="clickBtn_createRandomOne()"/>
          </div>
        </div>

        <script type="text/javascript" language="JavaScript">
            /* 表示項目の増減は以下の配列に反映すること */
            var select_list1 = [1,2,3,4,5];
            // 予備配列
            // var select_list2 = [];
            var all_members = [...select_list1
            // , ...select_list2
        ];
            /* リストを作成する */
            var list_parent = document.createElement("div");
            list_parent.setAttribute("class", "virticallist-div");
            for (i=0; i< all_members.length ; i++) {
              if ( i % 2 == 0 ) {
                var list_child = document.createElement("div");
                list_child.setAttribute("class", "horizontallist-div");
              }
              var list_element = document.createElement("div");
              list_element.setAttribute("class", "label-div");
              var list_checkbox = document.createElement("input");
              list_checkbox.type = "checkbox";
              list_checkbox.setAttribute("id", String(i));
              var list_label = document.createElement("label");
              list_label.innerHTML = all_members[i];
              list_element.appendChild(list_checkbox);
              list_element.appendChild(list_label);
              list_child.appendChild(list_element);
              if ( i % 2 == 1 ) { // ２列で折り返す
                list_parent.appendChild(list_child);
              }
            }
            if ( i % 2 == 1 ) { // 最終列が1名の場合
              list_parent.appendChild(list_child);
            }
            document.getElementById("wip").appendChild(list_parent);
            clickBtn_allChange(true, [0]);

            /* 一括操作 */
            function clickBtn_allChange(fig_bool, excludeUsers = []) {
              var id_str = "";
              for ( i=0 ; i< all_members.length ; i++ ) {
                id_str = String(i);
                if (excludeUsers.includes(all_members[i]) === false) {
                  document.getElementById(id_str).checked = fig_bool;
                }
              }
            }

            /* WIP作成 */
            // function clickBtn_createWip() {
            //   var output_str = "WIPを作成します";
            //   document.getElementById("message").innerHTML = output_str;

            //   // 最大WIPを取得
            //   var max_wip_txt = document.getElementById("max_wip").value;
            //   var max_wip_num = parseInt(max_wip_txt, 10);
            //   // output_str = output_str + "<br>最大WIP数：" + max_wip_txt;
            //   document.getElementById("message").innerHTML = output_str;

            //   // 最低人数を取得
            //   var min_member_txt = document.getElementById("min_member").value;
            //   var min_member_num = parseInt(min_member_txt, 10);
            //   // output_str = output_str + "  最低人数/WIP：" + min_member_txt;
            //   document.getElementById("message").innerHTML = output_str;

            //   // wip参加者を取得
            //   var wip_member1 = [];
            //   var wip_member2 = [];
            //   for ( i=0; i<(select_list1.length+select_list2.length) ; i++ ) {
            //     id_str = String(i);
            //     if ( document.getElementById(id_str).checked == true ) {
            //       if ( i < select_list1.length ) {
            //         wip_member1.push(select_list1[i]);
            //       } else {
            //         wip_member2.push(select_list2[i-select_list1.length]);
            //       }
            //     }
            //   }
            //   // output_str = output_str + "<br>参加者：<br>" + wip_member1 + "," + wip_member2;
            //   document.getElementById("message").innerHTML = output_str;

            //   // wip数を決定 (人数/最低人数が最大wipより小さい場合、wip数を減らす)
            //   if ( ((wip_member1.length+wip_member2.length)/min_member_num) < max_wip_num ) {
            //     max_wip_num = Math.floor((wip_member1.length+wip_member2.length)/min_member_num);
            //   }
            //   output_str = "本日のWIP数：" + String(max_wip_num);
            //   document.getElementById("message").innerHTML = output_str;

            //   // 各wipに振り分ける
            //   var wip_team = [[], [], [], []];
            //   var random_num = 0;
            //   var team_num = 0;
            //   for( i=0; i<wip_member1.length; ) {
            //     random_num = Math.floor( Math.random() * wip_member1.length );
            //     wip_team[team_num].push(wip_member1[random_num]);
            //     wip_member1.splice(random_num, 1);
            //     team_num = team_num + 1;
            //     if( team_num == max_wip_num ) {
            //       team_num = 0;
            //     }
            //   }
            //   for ( ; i<wip_member2.length ; ) {
            //     random_num = Math.floor( Math.random() * wip_member2.length );
            //     wip_team[team_num].push(wip_member2[random_num]);
            //     wip_member2.splice(random_num, 1);
            //     team_num = team_num + 1;
            //     if( team_num == max_wip_num ) {
            //       team_num = 0;
            //     }
            //   }
            //   output_str = output_str + "<br>WIP分け：";
            //   for( i=0 ; i<max_wip_num ; i++ ) {
            //     output_str = output_str + "<br>" + wip_team[i];
            //   }
            //   document.getElementById("message").innerHTML = output_str;

            //   // slack送信(送信ONの場合)
            //   if ( document.getElementById("slack").checked == true ) {
            //     // 送信文字列を作成
            //     var send_slack_str = "";
            //     for( i=0 ; i<max_wip_num; i++ ) {
            //       send_slack_str = send_slack_str + wip_team[i] + "\n";
            //     }
            //     // slackに送信する
            //     var ret = "<br>slackに送信しました";
            //     put_slack(send_slack_str,"本日のWIP");

            //   } else {
            //     var ret = "<br>slackには送信しません";
            //   }
            //   output_str = output_str + "<br>" + ret;
            //   document.getElementById("message").innerHTML = output_str;
            // }

            /* random順番作成 */
            // function clickBtn_createRandom() {
            //   var output_str = "randomを作成します";
            //   document.getElementById("message").innerHTML = output_str;

            //   // wip参加者を取得
            //   var wip_member1 = [];
            //   var wip_member2 = [];
            //   for ( i=0; i<(select_list1.length+select_list2.length) ; i++ ) {
            //     id_str = String(i);
            //     if ( document.getElementById(id_str).checked == true ) {
            //       if ( i < select_list1.length ) {
            //         wip_member1.push(select_list1[i]);
            //       } else {
            //         wip_member2.push(select_list2[i-select_list1.length]);
            //       }
            //     }
            //   }
            //   document.getElementById("message").innerHTML = id_str;
            //   // 各wipに振り分ける
            //   var wip_team = [];
            //   var random_num = 0;
            //   for( i=0; i<wip_member1.length; ) {
            //     random_num = Math.floor( Math.random() * wip_member1.length );
            //     wip_team.push(wip_member1[random_num]);
            //     wip_member1.splice(random_num, 1);
            //   }
            //   for ( ; i<wip_member2.length; ) {
            //     random_num = Math.floor( Math.random() * wip_member2.length );
            //     wip_team.push(wip_member2[random_num]);
            //     wip_member2.splice(random_num, 1);
            //   }
            //   // 出力作成
            //   output_str = "ランダム順番：";
            //   for( i=0 ; i<wip_team.length ; i++ ) {
            //     output_str = output_str + "<br>" + wip_team[i];
            //   }
            //   document.getElementById("message").innerHTML = output_str;

            //   // slack送信(送信ONの場合)
            //   if ( document.getElementById("slack").checked == true ) {
            //     // 送信文字列を作成
            //     var send_slack_str = "";
            //     for( i=0 ; i<wip_team.length; i++ ) {
            //       send_slack_str = send_slack_str + wip_team[i] + "\n";
            //     }
            //     // slackに送信する
            //     var ret = "<br>slackに送信しました";
            //     put_slack(send_slack_str,"ランダム順番：");

            //   } else {
            //     var ret = "<br>slackには送信しません";
            //   }
            //   output_str = output_str + "<br>" + ret;
            //   document.getElementById("message").innerHTML = output_str;
            // }

            /* random順番作成 */
            // function clickBtn_createRandomOne() {
            //   var output_str = "randomに１名ピックアップします";
            //   document.getElementById("message").innerHTML = output_str;

            //   // wip参加者を取得
            //   var wip_member1 = [];
            //   for ( i=0; i<(select_list1.length+select_list2.length) ; i++ ) {
            //     id_str = String(i);
            //     if ( document.getElementById(id_str).checked == true ) {
            //       if ( i < select_list1.length ) {
            //         wip_member1.push(select_list1[i]);
            //       } else {
            //         wip_member1.push(select_list2[i-select_list1.length]);
            //       }
            //     }
            //   }
            //   document.getElementById("message").innerHTML = id_str;
            //   // ランダムに１名選出
            //   random_num = Math.floor( Math.random() * wip_member1.length );
            //   output_str = output_str + "<br>" + wip_member1[random_num];
            //   // slack送信(送信ONの場合)
            //   if ( document.getElementById("slack").checked == true ) {
            //     // 送信文字列を作成
            //     var send_slack_str = wip_member1[random_num];
            //     // slackに送信する
            //     var ret = "<br>slackに送信しました";
            //     put_slack(send_slack_str,"ランダムピックアップ：");

            //   } else {
            //     var ret = "<br>slackには送信しません";
            //   }
            //   output_str = output_str + "<br>" + ret;
            //   document.getElementById("message").innerHTML = output_str;
            // }

            /* slackへ通知する */
            function put_slack(send_str,send_title) {
              send_text = "\n" + send_str;
              const slackChId = ""
              const url = `https://hooks.slack.com/services/${slackChId}`;
              const data = {
                "text": send_text,
                "channel": "#mobile-front-dev",
                "username": send_title,
                "icon_emoji": ":sunny:"
              };
              const xml = new XMLHttpRequest();
              xml.open("POST", url, false);
              xml.setRequestHeader("content-type", "application/x-www-form-urlencoded;charset=UTF-8");
              xml.send(`payload=${JSON.stringify(data)}`);
            }
        </script>

        <div class='kakomi-title01'>
          一括操作
        </div>
        <div class='kakomi-frame01'>
            <div class='button-div'>
              <input type="button" value="一括ON" onclick="clickBtn_allChange(true)"/>
              <input type="button" value="一括OFF" onclick="clickBtn_allChange(false)"/>
              <label class="label-div"><input type="checkbox" id="slack">Slack送信</label>
            </div>
          </div>
        </div>
        <div class='kakomi-title01'>
          WIPメンバー一覧
        </div>
        <div class='kakomi-frame01' id="wip">
          改修中
        </div>
        <div class='kakomi-title01'>
          お知らせ
        </div>
        <div class='kakomi-frame01'>
          <div id="message"></div>
        </div>

    </body>
</html>